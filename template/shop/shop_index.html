{% extends "base.html" %}
{% block title %}

{% endblock %}

{% block javascriptblock %}

{% endblock %}

{% block body %}
<div id="category"></div>
<div id="product"></div>
{% verbatim %}

<script>
    function update_product_list(category_id){
        if(category_id == "init"){
            alert("init");
        }
        else{
            $.AMUI.progress.start();
            alert("update" + category_id);
            $.AMUI.progress.done();
        }
    }

    $(function () {
        $.AMUI.progress.start();
        window.onhashchange = function(){
            update_product_list(window.location.hash.substring(1));
        };
        $.ajax({
            url: "/category/?shop=1",
            method: "get",
            dataType: "json",
            success: function (json) {
                var category_content = [];
                for (var item in json) {
                    var menu = {subMenu: [], "subCols": "4"};
                    menu.title = json[item].name;

                    for (var sub in json[item]["child_category"]) {
                        menu.subMenu.push({title: json[item]["child_category"][sub].name,
                            "link": "#" + json[item]["child_category"][sub].id})
                    }

                    if(!menu.subMenu.length){
                        menu.link = "#" + json[item].id
                    }
                    else {
                        menu.link = "#";
                    }
                    category_content.push(menu);
                }
                console.log(category_content);
                console.log("ajax success");
                var template = Handlebars.compile('{{>menu}}'),
                        data = {
                            category_data: {
                                "theme": "default",
                                "options": {
                                    "cols": 5, // 一级菜单列数 [1-12]
                                    "offCanvasFlip": false
                                },
                                // 菜单数据
                                "content": category_content
                            }
                        },
                        html = template(data.category_data);

                $('#category').html(html);
                update_product_list("init");

                $.each(['slider', 'menu', 'gallery', 'footer', 'navbar'], function(i, m) {
                  var module = $.AMUI[m];
                  module && module.init && module.init();
                });
                $.AMUI.progress.done();
            }
        });




    });
</script>
{% endverbatim %}
{% include 'foot.html' %}
{% endblock %}